---
title: PYQT5应用(实现一个课程NEO4J知识图谱系统)
author: lonelywatch
date: 2023-7-25 2:28 +0800
categories: [QT]
tags: [QT,PYTHON,PYQT5,NEO4J]
---

## 介绍

除了之前的课程爬取外，课设还需要用PyQt实现一个简易的课程知识图谱程序。程序需要实现用户的注册登录注销，用户可以增删查改可视化的知识图谱，点击知识节点，需要显示爬取的相关课程。

Qt作为一套前后端框架，是很具有学习意义的。它可以用纯代码实现界面，更好地是用QtDesigner很方便地设计出界面，然后用代码实现逻辑，实现界面和逻辑很好的分离。

### QtDesigner的使用

可以通过安装包`pyqt5-tools`安装，通过`pyqt5-tools designer `打开程序，界面文件保存为`.ui`文件，通过pyuic工具转化为py文件。pyrcc可以将designer需要的qrc转化为py文件。

除了普通的控件外，需要注意布局的使用。同时可以将普通的部件提升为自定义的部件。

### 自定义部件

可以重写部件类来增加新的功能，这极大地提高了可拓展性。

### 信号与槽

信号与槽实现了对象间的交互。自定义信号需要作为以QObject为基类的子类的类属性（不应放在init方法中,否则会报相应的）并且还可以使用信号过滤来实现某个对象监听其他对象的信号。

## 程序

第一步就是逻辑的设计。

从登录界面，转移到主界面，主界面通过StackedWidget实现导航栏和五个子界面.分别用于展示用户的个人信息,拥有的图谱,当前展示的图谱,以及节点搜索的课程结果.

然后就是不断地实现细节.

第一个部分就是知识图谱的绘画,以及节点的搜索.

这里重写了QGraphicsView,QGraphicsTextItem,QGraphicsEllipseItem,用于实现MyNeo4jView,MyNeo4jNodeItem,MyNeo4jRelationItem.

然后重写其与mouse事件相关的方法,实现拖拽和点击.由于需要继承QObject才能发射自定义信号.为了统一管理,将自定义信号放在了单独的文件中使用单例进行创建(不然总是报错connect不存在).然后使用eventFilter在MyNeo4jView中监听对节点的点击.得到点击的课程名后将其发射到展示节点搜索结果的窗口中,从数据库中得到相应的结果并通过QTableView展示.

第二个部分就是如何管理用户数据.

一个用户除了用户名和密码,还可能有若干个neo4j的数据库,以及书签.

第三个部分那就是如何实现对多个neo4j数据库进行操作.

### neo4j连接池

neo4j的连接在第一次使用时会比较耗时，造成卡顿，所以用连接池线程提前处理好一定数量的连接，使用时只需要分配。

关于如何创建多个知识图谱，只需要以用户名和图谱名为标签就可以实现。

## eventFilter

事件过滤很有用。它会优先事件的槽函数进行处理。比如要实现点击列表的某项才能开启一些按钮，只需要提前检测该部件的点击事件进行处理就好了。

## 总结

熟悉了这套框架，把之前数据库和爬虫的知识又过了一遍，遗憾的是写的并不好，后面为了赶时间有点凑了。一开始想着还得写套服务端导入导出不同实例的neo4j文件，结果发现可以直接用标签来代表不同实例，也算是复习了一遍。