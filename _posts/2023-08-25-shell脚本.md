---
title: shell脚本
author: lonelywatch
date: 2023-08-25 10:05
categories: [SHELL]
tags: [SHELL,LINUX]
---

# shell脚本

shell脚本为由shell命令和一些语句组成的文件。shell有不同版本，下面所讨论的基本为bash shell。在文件第一行使用`#!`来指定使用的shell版本。

## 变量

变量分为环境变量（可通过set指令查看所有环境变量）和用户自定义变量。

变量名由任意字母，数字下划线组成，且不超过20个字符，并且区分大小写。

自定义变量时，变量名，等号以及值之间不能留有其他空白字符。变量在shell脚本中以字符串的格式存储，并且由使用的命令决定格式。在使用变量时，通过`$`引用，有时也使用`${}`来界定使用的变量。

可以将命令的输出赋予变量（命令替换），有两种方式：

- 使用反引号将命令括起来
- 使用`$()`将命令括起来

在shell中可以使用`expr`命令进行数学运算（对于一些特殊的运算符需要使用反斜线）。也可以使用`$[]`来执行数学运算并返回。bash shell 是不支持浮点数运算的。

shell 的退出使用`exit <exitcode>`，结束时会返回该退出状态码（一个uchar大小的整数），在linux中使用`$?`来保存该退出码。如果不使用exit，则返回最后被执行的命令的返回码。

## 结构化命令

我把他们当作是控制流，大概有条件判断以及循环等类型。

### if-else

其基本形式为：

```shell
if command1
then
	command2
elif comand3
then 
	command4
...
else
	commandn
fi
```

if条件为命令的执行语句被执行，当且仅当该命令的返回码为0。

可以使用`test <condition>`指令和`[ <condition> ]`（[]与条件间必须保留空格）来判断除命令返回码之外的条件。

对于条件判断有：数值比较，字符串比较，文件比较。

比较可以使用比较符号（但是在使用一些在shell中有其他用途的符号时需要转义），也可以使用`-<cpr>`,cpr基本类似形式：eq，ne，gt，lt，le，ge(对于字符串比较和文件比较，还有其他的单字母比较符)。

常用的有：使用`-n`和`-z`检测变量是否为空，`-d`检测文件是否为目录,`-e`检测文件是否存在。

对于复合条件，使用`[ ]&&[]`和`[  ]||[  ]`的形式。

bash还提供了一些条件判断的高级特性：使用单括号使用子shell，使用双方括号来对字符串进行额外的处理，

### for

类似于for-in，在shell中的for基本为：

```shell
for var in list
do 
	command
done
# 选自linux命令行与shell脚本大全
```

list可以是列表字面量，也可以是变量。可以通过指定`IFS`变量的值来指定分隔符。

bash shell中也提供了c语言分隔的for，基本为：

```shell
for ((variable assignment;condition;iteration process))
do 
	commands
done
# 选自linux命令行与shell脚本大全
```

在for括号中，等号两旁可以有空格，变量不需要`$`引用。

### while和until

```shell
while/until [ condition ]
do
	command
done
```

while的条件为命令时，当命令返回码为0时会执行一次循环，until与while相反。

---

对于有do，并且前面有指令的情况，可以将do和该指令放在一行，用`;`隔开。

在这些语句后都可以使用重定向符。

### 输入

可以使用命令行参数向shell脚本传递数据，在shell脚本中`$i`为输入的第i个参数（从1开始，$0为脚本名）特殊的，`$#`为命令行参数的个数，`$*`包含所有命令行参数。



