---
title: LAB2 挑战性任务
author: lonelywatch
date: 2023-6-12 22:08 +0800
categories: [OS]
tags: [OS,TLB,MIPS]
---

​	这是所有的挑战性任务中最简单的一个，要求实现tlb快重填，并实现示例程序，大概就是tlb无效化和重填。

​	关于tlb，mips 只有KUSEG 和 KSEG2 经过tlb，只有这两个地方会产生tlb缺失，mips对于KUSEG的tlb缺失，有特殊的异常处理地址`0x80000000`，而其他的异常和KSEG2的tlb缺失则是在`0x80000080`这个地址。

​	在之前tlb的处理，则是找到页表中的记录，找不到则判断情况是否分配页面重填，它需要经过上下文的保存，位处理记录，重填，上下文的恢复。mips对于KUSEG有着特殊快速的处理方法（因为KUSEG tlb缺失会有很多）。

​	context寄存器中(R3000)前11位页表的高位，随后的19位为ENTRYLO记录的tlb缺失的页号，最后两位为全0。这就是tlb缺失的要填的页表记录的地址。

​	页表的最高位需要填充，故页表需要映射到KSEG2，这当然是有原因的，KSEG2也会产生tlb缺失，在快速重填处理过程中也可能会产生KSEG2的tlb缺失（因为页表会映射到KSEG2，在开始时并没有填充至tlb，但是这种KSEG2的tlb缺失十分少，可以认为基本在运行过程中不会产生），这种**异常重入**需要保存上下文，在这里，异常会修改context和enteyhi以及entrylo寄存器，context的保存很特别，只需要保存该寄存器，在恢复时只需要使用而非赋值给该寄存器！！

​	因为这种快速处理只针对KUSEG，虚拟页号的最高位必然为0，即最高位0X7FFFF000, 所以CONTEXT会省略掉最高位，记录随后的19位，就就是为什么虚页号只有19位。

​	然后只需要根据该地址填充tlb就好了，关于示例程序，我们可以tlb无效化大量页，然后依次访问。