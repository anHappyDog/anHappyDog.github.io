---
title: 数据库系统原理
author: lonelywatch
date: 2023-09-5 15:14
categories: [数据库]
tags: [数据库,SQL]
---

## 开始

概念庞杂而缺少完整的俯瞰，仿佛雾里观花，不知全貌。

----

对于数据的处理经历了 程序内处理数据，文件系统，以及现在的数据库系统这么三个阶段。

相比于使用数据库系统，文件系统有很多缺点：

- 数据冗余大，浪费空间，并且不利于维护和管理（数据分散，格式也可能不一致，应用程序更新与维护难度大）。
- 一致性，安全性，完整性等问题难以保证（安全性：数据具有访问权限。一致性：对于不同处的同一数据，必须保证内容相同。完整性：**一致性约束**，对于每个属性都有其**域**）。
- 并发访问异常，并且原子性问题难以解决。

**数据库系统**是 一组相互关联的数据以及一组使得用户可以对数据进行操作的程序的集合。其主要目的为 给用户提供数据的抽象视图，并且隐藏关于数据存储与维护的细节。

### 数据抽象

在数据库系统中，可以抽象出**物理层**（内模式），**逻辑层**（模式），**视图层**（子模式）（名称因人而异）这么三个层次。其中又存在着**内模式-模式**，**模式-子模式**这么两个**映像**。这种架构很好地解决了文件系统存在的问题。

- 物理层：描述数据的物理存储结构。
- 逻辑层：描述数据的逻辑存储结构和元数据（数据的数据，描述数据的关系，数据的语义等）。
- 视图层：为用户提供对数据的接口。

### 实例与模式

**数据库模式**：数据库的总的设计。

**数据库实例**：数据库中某一时刻所有信息的集合。

类似于类与对象（可能并不恰当）。

### 数据库语言

数据库语言可分为**数据定义语言**(DDL)和**数据操纵语言**（DML）。

#### 数据定义语言

数据定义语言描述了如何去定义一个 数据库模式。 比方在SQL中的create语句就会创建一个数据库。

#### 数据操纵语言

对数据进行CRUD操作的语言。

可分为

- 声明式DML：使用数据时只需要指明数据。
- 过程式DML:   除了指明数据外，还需要指明数据的来源。



### 数据独立性与数据模型

**数据独立性**有：

- 物理独立性： 应用程序并不依赖于物理层。

- 逻辑独立性：应用程序并不依赖于逻辑层。

**数据模型**有这么几种：

- E-R模型

- 关系模型

- 半结构化模型

- 面对对象模型

### E-R模型介绍

E-R模型由**实体**（Entity）与**关系**（Relation）组成。

- 实体： 客观世界中可区别于其他对象的“物体”或“事情”。对于实体，使用**属性**来描述实体。
- 联系：两实体间存在的联系。

同一类型组成的所有实体集合为**实体集**，同两实体间的所有联系为**联系集**。

可以使用**E-R图**来描述E-R模型（可以使用UML（统一建模语言）来绘图）。

对于一个E-R图：

实体集使用矩形表示，其中 实体集名字在上面，属性名在下面。

关系集使用连接两实体集的菱形表示，中间包含关系名。

### 数据存储和查询



#### 存储管理器

> 存储管理器是数据库系统中负责在数据库中存储的低层数据与应用程序，以及向系统提交的查询提供接口的部件，负责与文件系统进行交互。

主要包含：

- 权限及完整性管理器：负责检查**完整性约束**以及权限。
- 事物管理器：保证即使出现故障，数据库也会保持正确的状态，并且确保并发事物不冲突。
- 文件管理器：负责与文件系统进行交互，管理磁盘上存储信息的数据结构。
- 缓冲区管理器：将数据从磁盘读入内存。

存储管理器实现了以下数据结构：

- 数据文件
- 数据字典（元数据）
- **索引**（提供指向包含特定值的数据的指针）

#### 查询管理器

主要包括：

- DDL解释器：负责解释DDL语句，并且将定义记录在 数据字典 中。
- DML解释器：将DML转化成执行方案（执行引擎能理解的低级语句）。

- **查询执行引擎**： 执行DML解释器生成的低级指令。

### 事物处理

**事物**是 数据库应用中完成单一逻辑功能的操作集合。

要求**原子性**（执行中的操作不可中断），**一致性**，**持久性**。

**事务管理器**中包含 恢复管理器 和 并发控制管理器。

原子性与一致性 由 **恢复管理器**来保证（故障发生时，恢复之前的状态来保证原子性和一致性）。

**并发控制管理器**负责管理并发事物的相互影响，从而保证一致性。

### 应用体系

数据库系统的应用体系常见的有 **二层体系** 和 **三层体系**。

- 二层联系： 应用程序与DBMS分别在客户机和服务机上。其中业务逻辑部署在客户机上。
- 三层联系： 和二层联系不同的是，客户机上只存在表单与服务器进行交互，其中的业务逻辑被放在了服务端上。（这种体系常被用于大型系统与互联网程序。）

## 关系型数据库

### 表 

关系型数据库由**表**的集合组成。

对于一个表，有着若干行和若干列。

- 行：表中一组值的联系，对于这种联系，可以使用元组来表示（元组无序）。
- 列：是表（或者说是**关系**）的属性。

在关系型数据库中，**关系**指代表，而**元组**指定行（或者通俗的说是**记录**）。

**域**：表中属性的所有取值集合。我们要求表中的所有取值都必须是**原子**（不可再分）的。

### 数据库模式

**数据库模式**是数据库的一个定义，而**数据库实例**则是数据库模式的一个快照。

对于**关系模式**也是类似。关系模式类似于高级程序语言中的变量类型，而**关系**则是定义的变量。

### 码

在一个关系中，不可能有两个元组的值完全相同。

**超码**是关系属性集合的一个子集，为了区别两个不同的元组，两个元组在超码上不可能完全相同。（任何**超码**的超集都是超码，我们通常说 其中的 最小集为**候选码**），在数据库中，超码被称为**主码**。

**外码**表示一个关系中包含着另一个关系的属性子集。其中被包含关系被称为 该外码依赖的**被参照关系**，包含关系被称为该外码以来的**参照关系**。

### 模式图

对于含有主码和外码依赖的数据库模式 可以 使用**模式图** 。

在模式图中，关系使用矩形表示，关系名在上面，属性在下面。

在关系中，主码通过在属性名下使用下划线来表示。外码通过依赖关系指向被依赖关系的箭头表示。

### 关系查询语言

对于查询语言可以是**过程化**（除了数据的信息，还需要给出一系列的操作）的，也可以是**非过程化**（只需给出信息）的。

## SQL

### 介绍

SQL是一门查询语言（尽管包含许多其他的数据操作）。

SQL最早由IBM开发，最初名叫Sqeuel。

SQL语言有以下几部分：

- DDL：定义关系模式，对关系的CRUD。
- DML：对数据的CRUD。
- 完整性：SQL DDL中包含对完整性约束的命令，数据必须满足完整性约束。
- 视图定义：SQL DDL中包含定义视图的命令。
- 事物控制： SQL中包括定义事物的开始和结束的命令。
- 授权：SQL DDL中包含定义对关系和视图的访问权限的指令。

### 数据类型

SQL支持的数据类型有：

- char(n) :定长字符串
- varchar(n):不定长字符串，最大长度为n
- int: 整数
- smallint:小整数
- numeric:定点数
- float: 浮点数 

其中每种类型都包含**空**值。

### 操作

---

创建关系模式使用`create table <tbName> (...attributeList); `。

其中使用`primary key(a1,a2,...,an)`来指定主码，使用`foreign key(a1,a2,...,an) reference tbName `来指定外码。

---

使用`delete from tbName`语句来进行删除关系中的行。

使用`alter table`来修改关系。

...

使用`insert`来插入数据。

#### 查询



