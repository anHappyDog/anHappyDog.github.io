---
title: C语言系统级编程
author: lonelywatch
date: 2024-9-7 21:28 +0800
categories: [LANGUAGE]
tags: [LANGUAGE,C] 
---

# C语言系统级编程

这是校内的一门选修课，事实上我认为是一门非常好的课程，让我对于C语言有了透彻的理解。也明白了很久以前在编译器上出现的莫名的错误。授课老师幽默且认真，课程内容也很充实，如果OO也是这位老师我大概会很开心。

## 对象与类型

> 简单源于规整。

### 对象

C语言中的对象是指**存储在内存中的数据区域，并且通常具有若干值**，这与面对对象中的对象的概念有所不同。C语言很灵活，对于变量与常量的界限往往并不明朗，比如`const`修饰定义时我们通常认为是常量，但是`const volatile`在OS中是可变的。这一概念的不明朗其实会让编译器实现变得复杂，所以**C语言并没有真正的变量与常量的概念**，将其理解为对象会更加合适。对象就是内存中的某段连续区域，我们使用**标识符**`Identifier`来引用这一对象，尽管引用这一词与其他高级语言中的引用定义的操作有所不同。

### 类型

内存可以被简单地理解为字节数组。一字节Byte通常由8比特bit组成，对于特定的架构，内存的寻址位宽通常有16位，32位，64位，128位，这一位宽确定了机器的最大寻址范围。需要注意，在某些特定架构中一字节可能并不等于8比特。

对象既然是内存中的数据区域，那么就可被解释成某一**类型**，也即对象的表示。对象的值相同，对象的表示相同；对象的表示相同，对象的值可能不同。类型又分为**完全对象类型**与**不完全对象类型**，其区别在于是否定长（如果了解过RUST会发现RUST很大程度上利用了Sized这一Trait来实现类型安全等特性，也即完全对象类型）。完全对象类型拥有`size`与`align`两大属性，通过`size_of`与`align_of`来获取。


C语言中的类型主要被定义为 基本数据类型，派生数据类型。基本类型主要包括：CHAR型，有符号整数，无符号整数，浮点数等 CHAR包含char，unsigned char与signed char 三类类型。 C语言中的CHAR型被定义为`CHAR_BITS`比特大小（该宏由C语言提供，并且在大多数情况下值为8，某些情况可能并不为8）。对于无符号整数类型，C语言有着其他的定义，主要有：

- `short int`：至少16位

- `int`：至少16位

- `long int`：至少32位

- `long long int`：至少64位

请注意上面提到的“至少”一词，这是因为C语言并没有规定具体的位宽，而是通过`limits.h`头文件来定义。早期诸如Object-C对于`size_of(int)`的返回值则为2，也即16位，虽然目前大多数情况都为32位。为了使用确切的位宽，C语言在`stddef.h`中提供了`int8_t`，`int16_t`，`int32_t`，`int64_t`等类型，这些类型的位宽被C语言确定为固定的。在移植情境中，为了提高软件的可移植性，通常会使用`typedef`来定义所使用的类型来避免不同平台的位宽差异。

对于有符号整数，其数据区域由`Signed bit`,`value bit`以及`padding bit`三部分组成。对于无符号整数，其数据区域由`value bit`以及`padding bit`两部分组成，需要注意CHAR型没有`Padding bit`。

对于浮点数，C语言中有`float`，`double`，`long double`三种类型，分别对应于单精度浮点数，双精度浮点数，长双精度浮点数。这些类型的位宽并没有被C语言规定，而是通过`float.h`头文件来定义。对于浮点数，其数据区域由`sign bit`，`exponent bit`，`fraction bit`三部分组成。

对于派生数据类型，C语言中有`数组`，`指针`，`结构体`，`共用体`，`枚举`，`原子`与`函数`等，其中函数之前的类型为对象类型，而函数单独作为函数类型。这些类型的定义与基本数据类型有所不同，其定义更加灵活，可以根据需要定义。对于数组，其定义为`type name[size]`，对于结构体，其定义为`struct name{type name;type name;...}`，对于共用体，其定义为`union name{type name;type name;...}`，对于枚举，其定义为`enum name{value,value,...}`。这些类型的定义可以嵌套，比如结构体中可以包含数组，共用体，枚举等。

#### 数组类型

形式化定义为T[N]，T为元素类型，且必须为完全对象类型，N表示数组元素的个数。若没有指定N，则该类型为不完全对象类型。如果N为常量或常量表达式，则T[N]为普通数据类型，否则为变长数组类型。数组被视为`Array of T`。

> 常量指单纯的数，而常量表达式指常量与运算符的组合。

如果使用`typedef`来别名数组类型，通常用法为`typedef int Array[5]`，这样`Array`就被定义为`int[5]`类型,请注意中括号的位置。C23中提供了`typeof(T)`来将T处理为整体。

完全对象数组类型仍然能够派生。对于`int[5]`，若N为10，则`int[10][5]`的引用数据类型为`int[5]`，请注意\[10\]的位置。

所以对于数组类型的代码解析，只需要将从左至右的第一个\[N\]去掉即为元素类型。

#### 指针类型

形式化定义为T*，T为元素类型，可为不完全对象类型。指针被视为`Pointer to T`。指针类型的引用数据类型为T。

对于引用类型为数组类型的派生，通过在第一个中括号前添加`(*)`来表示对应指针类型；对于引用类型为指针类型的派生，通过在表示其为指针的`*`后添加`*`来表示对应指针类型。

对于引用类型为指针类型的派生，通过在表示其为指针的`*`后添加中括号来表示对应数组类型。

在识别过程中，括号的优先级最高，优先寻找最内层的括号。

![](https://lonelywatch-1306651324.cos.ap-beijing.myqcloud.com/image-20240908121445495.png)

> 该图取自课程PPT。


## attribute

## 参考

1. [C Specification](https://www.iso.org/standard/74528.html)
