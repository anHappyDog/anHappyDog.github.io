---
title: PCI与PCIE
author: lonelywatch
date: 2024-7-13 21:28 +0800
categories: [KERNEL]
tags: [PCIE,KERNEL] 
---

# PCI与PCIE

## PCI

`PCI`(Peripheral Component Interconnect)中文名为**外围组件互连**,是一种总线标准,用于连接计算机的外围设备. PCI不同的版本支持33MHz,66MHz一级133MHz的时钟频率,并且支持32位和64位的数据总线. 现如今已被PCIe所取代.

总的来说，PCI支持计算机交互多种设备。PCI总线之间可以通过PCI桥与ISA桥来进一步扩展可搭载设备的数量。PCI设备与PCI局部总线相连，PCI局部总线与计算机总线相连来进行通信，PCI桥的作用就是用来联通不同的PCI总线使之能够相互通信。

PCI为所有的连接设备提供了256字节的配置空间。配置空间的访问往往取决于连接PCI局部总线的方式，很多情况下需要通过北桥芯片来访问，对北桥芯片的访问地址寄存器写入需要访问的PCI配置空间地址，就可以通过北桥的访问数据寄存器来读写数据。通过读取配置空间的设备ID和厂商ID来识别设备，0XFFFF表示空设备。 

一个PCI设备可以有多个Function，多个Capability，每个Function都有上面提到的256字节配置空间。Function的意义在于，一个设备可能会提供多种功能，很多情况下这些功能独立运行，所以需要独立地对其配置，同时每个Function可以提供多个Capability，这些Capability可以被理解为特性，比如设备的电源管理等。Capbaility的属性存放于配置空间中，属性结构体存放了数据存放的地址（BAR）。PCI在配置空间中提供了5个32位的BAR配置，用来存放设备的内存地址或IO地址。对于之前提到的属性结构体，其BAR成员则提供了capability数据存放的地址，通过其offset成员就找到capability的数据。


### Function


### Configuration Space

![](https://lonelywatch-1306651324.cos.ap-beijing.myqcloud.com/image-20240814104208595.png)

### IO Space

### Memory Space


## PCIE





## 参考文献

1. [PCISIG](https://pcisig.com/specifications/conventional/)