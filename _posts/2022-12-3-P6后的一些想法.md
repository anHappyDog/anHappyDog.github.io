---
title: 计组P6后的一些想法
date: 2022-12-3 11:37:00 +0800
categories: [BUAA,计组]
tags: [计组]
author: lonelywatch
toc: true
---

### P6

#### 描述

在P5的基础上添加指令，并将DM,IM外置。

使用分布式译码（P5之前我都是用集中译码，但是后来发现分布译码就个人而言修改难度要低一些）

转发阻塞沿用P5的AT法。

课上指令：注意某些条件写指令在写入地址和写使能未确认的时候可能需要暂停1周期。

#### 指令

![instr](/assets/img/co/p6/instr.PNG)

#### 模块设计

![module table1](/assets/img/co/p6/m1.PNG){: .normal }

![module table2](/assets/img/co/p6/m2.PNG){: .normal }

![module table3](/assets/img/c0/p6/m3.PNG){: .normal }



#### 阻塞和转发

这里借用高老板P5的图^ - ^

![design](/assets/img/co/p6/design.PNG)

需要转发的有D,E,M三级，提供数据的有M,W两级，根据Tuse和Tnew构造策略矩阵来实现ATCONTROL（暂停转发控制器）。

stall（暂停）时需要使得E级流水寄存器（图中第二个）清空，（插入nop指令），暂停D级流水寄存器和PC的写入。

转发信号由ATCONTROL生成就行。

#### 测试

课程组会发测试指令覆盖率的程序，其实（大概）只需要测试冲突指令就好了，出现的错误大致有**搭线错误**（ISE搭错线没有报错，如果打错字有时很难找到~ _ ~）,转发错误，写入错误，根据指令有根据地找错效率可能会高些。

#### 后话

我个人认为计组考验的是我们系统的工程能力，课下**在实现前进行建模和设计往往比边实现要边设计要快很多。**并且这种设计往往会加速我们后续的P，从而提高我们的效率。

事实上如果掌握了流水线的运行方式，课上添加指令其实是较为简单的，课程组要求的流水线需要F（取指），D（译码），E（执行），M（访存），W（回写），根据提供的RTL分析数据通路和控制器然后实现就好了。有个地方需要注意的是，在课上开始时可以先看完所有题，可能后面的题目是自己很快能解决的。

看到这里发现自己从什么都不明白变得稍微明白了一点，这就是计组带给我的收获，我很高兴我能学到很多，之前自己毛毛躁躁，还总是抵抗不了诱惑，课下手工（>_<）浪费De了很多时间（其实可以用mars魔改版自动对测），现在稍微能够明白设计的好处，也算是自己的一点小小进步吧。

我自己代码地址：

[anHappyDog/- (github.com)](https://github.com/anHappyDog/-)

(内有课程组魔改版Mars)
